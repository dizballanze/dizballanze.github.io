<!DOCTYPE html>
<html lang="en">
<head>
        <title>Tech blog by @dizballanze - ftpd</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/theme/css/app.css" type="text/css" />
        <link href="http://dizballanze.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Tech blog by @dizballanze Atom Feed" />
        <link href="http://dizballanze.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Tech blog by @dizballanze RSS Feed" />
        <link href="/static/icons/favicon.ico" rel="icon" type="image/x-icon" />
        <link href="/static/icons/favicon.ico" rel="shortcut icon" type="image/x-icon" />
        
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ru_RU/all.js#xfbml=1&appId=143995599087385";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<a href="https://github.com/dizballanze">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="/">Tech blog by @dizballanze </a></h1>
                <nav><ul>
                    <li><a href="/avtor/">Автор</a></li>
                    <li ><a href="/category/bd.html">БД</a></li>
                    <li ><a href="/category/drugoe.html">Другое</a></li>
                    <li ><a href="/category/linux.html">Linux</a></li>
                    <li ><a href="/category/nodejs.html">Node.js</a></li>
                    <li ><a href="/category/python.html">Python</a></li>
                </ul></nav>
        </header><!-- /#banner -->
        
        

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/linux/stavim-ftp-server-v-debian/">Ставим FTP-сервер в Debian</a></h1> 
<footer class="post-info">
        <abbr class="published" title="2011-01-03T00:42:00+03:00">
                пн 03 января 2011
        </abbr>
<p>категория: <a href="/category/linux.html">Linux</a>. </p>
<p>теги: <a href="/tag/debian/">debian</a><a href="/tag/ftp/">ftp</a><a href="/tag/ftpd/">ftpd</a><a href="/tag/administrirovanie/">администрирование</a></p>
</footer><!-- /.post-info --><p><img alt="image" src="/media/2011/01/ftp_client.png" title="ftp_client" /></p>
<p>По просьбе моего друга рассматриваю установку ftp-сервера в Linux.</p>
<p>Начнем с того что установим демон ftpd. Т.к. я использую Debian, то
устанавливать будем при помощи apt-get:</p>
<div class="highlight"><pre>apt-get install ftpd
</pre></div>


<p>Итак, поставили, теперь проверяем запущен или нет:</p>
<div class="highlight"><pre>ps aux <span class="p">|</span> grep ftp
</pre></div>


<p>В моём случае не запущен, значит запускаем:</p>
<div class="highlight"><pre>/etc/init.d/ftpd start
bash: /etc/init.d/ftpd: Нет такого файла или каталога
</pre></div>


<p>Хмм...</p>
<div class="highlight"><pre>whereis ftpd
ftpd:
</pre></div>


<p>Так, что-то непонятное. При всём этом man ftpd выдаёт страницу
руководства. Пробуем перезагрузится...После перезагрузки ps не выдаёт
никакого результата при поиске слова ftpd также и whereis. Но проверив
свой хост nmap'ом я увидел следующее:</p>
<div class="highlight"><pre>nmap 127.0.0.1

Starting Nmap 4.62 <span class="o">(</span> http://nmap.org <span class="o">)</span> at 2011-01-02 23:37 EET
Interesting ports on localhost <span class="o">(</span>127.0.0.1<span class="o">)</span>:
Not shown: <span class="m">1708</span> closed ports
PORT     STATE SERVICE
21/tcp   open  ftp
25/tcp   open  smtp
80/tcp   open  http
111/tcp  open  rpcbind
631/tcp  open  ipp
2049/tcp open  nfs
3306/tcp open  mysql

Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 0.098 seconds
</pre></div>


<p>Как мы видим 21 порт открыт и на нём висит ftp-сервер. Бегло просмотрев
man ftpd разобрался с файлами конфигураций. Итак, смотрим что к чему:</p>
<ul>
<li><code>/etc/ftpusers</code> - список пользователей которым запрещён доступ к ftp.
    Формат файла прост, как рубанок - каждая новая строка имя
    пользователя, которому нужно обрезать доступ к питательному вымени
    file transfer protocol :)</li>
<li><code>/etc/ftpchroot</code> - список пользователей для которых текущая директория
    должна быть установлена в "искусственный" корень при помощи "chroot"
    перед началом работы.</li>
<li><code>/etc/ftpwelcome</code> - приветственное сообщение</li>
<li><code>/etc/motd</code> - сообщение после авторизации</li>
</ul>
<p>Оказалось всё довольно просто. Пробуем залогинится:</p>
<div class="highlight"><pre>ftp 127.0.0.1
Connected to 127.0.0.1.
<span class="m">220</span> dizballanze-laptop FTP server <span class="o">(</span>Version 6.4/OpenBSD/Linux-ftpd-0.17<span class="o">)</span> ready.
Name <span class="o">(</span>127.0.0.1:root<span class="o">)</span>: dizballanze
<span class="m">331</span> Password required <span class="k">for</span> dizballanze.
Password:
230- Linux dizballanze-laptop 2.6.26-2-686 <span class="c">#1 SMP Sat Dec 26 09:01:51 UTC 2009 i686</span>
230- 
230- The programs included with the Debian GNU/Linux system are free software<span class="p">;</span>
230- the exact distribution terms <span class="k">for</span> each program are described in the
230- individual files in /usr/share/doc/*/copyright.
230- 
230- Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
230- permitted by applicable law.
<span class="m">230</span> User dizballanze logged in.
Remote system <span class="nb">type </span>is UNIX.
Using binary mode to transfer files.
ftp&gt; <span class="nb">pwd</span>
<span class="m">257</span> <span class="s2">&quot;/home/dizballanze&quot;</span> is current directory.
</pre></div>


<p>Авторизация прошла успешно и я сразу получил доступ к файловой системе
от пользователя dizballanze без каких-либо дополнительных настроек.
Единственная проблема - это некорректное отображения русских надписей в
терминальном клиенте, но в gFTP всё отображается отлично. Советую
использовать именно его в качестве клиента. Подводя итоги перечислим 5
правил аутентификации ftpd:</p>
<ol>
<li>Логин должен находится в базе паролей системы - <code>/etc/passwd</code> и не
    должен быть равен null.</li>
<li>Логин не должен встречаться в <code>/etc/ftpusers</code></li>
<li>Пользователь должен иметь стандартный интерпретатор команд
    возвращаемый <code>getusershell</code></li>
<li>Если имя пользователя встречается в <code>/etc/ftpchroot</code> сессионный корень
    будет изменён на директорию входа при помощи chroot, как для
    "anonymous" или "ftp" аккаунта. Но тем не менее всёравно требуется
    пароль. Данная функция - это промежуточный этап между полностью
    анонимным и полностью привилегированным аккаунтом.</li>
<li>Если имя пользователя "anonymous" или "ftp", то анонимный
    ftp-аккаунт должен быть представлен в файле паролей (пользователь
    "ftp"). В таком случае пользователь получает возможность
    авторизироваться используя любой пароль (по соглашению принято
    использовать email в качестве пароля).</li>
</ol>
<p>FTPd предоставляет простой способ удалённого доступа к системе без траты
времени на конфигурирование системы. Очень удобно использовать свои
данные для удалённой авторизации. Но при этом стоит учитывать опасность,
которая возникает, т.к. теперь любой пользователь сможет получить доступ
к файлам узнав ваши логин и пароль, к тому же зачастую пароли для
пользователей на локальных машинах далеки от безопасных (по себе знаю).
Так что если вы планируете использовать FTPd советую изменить пароли на
безопасные или заблокировать аккаунты путём добавления их в
/etc/ftpusers. Спасибо за внимание! Да прибудет с вами сила :) !</p><p><a href="/linux/stavim-ftp-server-v-debian/#disqus_thread">comments</a></p>                </article>
<p class="paginator">
    Страница 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>ссылки</h2>
                        <ul>
                            <li><a href="http://wbtech.pro">WBTech</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>онлайн</h2>
                        <ul>
                            <li><a href="http://dizballanze.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="http://dizballanze.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                            <li><a href="https://twitter.com/dizballanze">Twitter</a></li>
                            <li><a href="https://github.com/dizballanze">GitHub</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Powered by <a href="http://getpelican.com/">Pelican</a>, <a href="http://python.org">Python</a>.
                <section class="right">&copy; <a href="/avtor">Yuri Shikanov</a> 2010-2015</section>
                </address><!-- /#about -->

        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-20497524-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'dizballanze';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>