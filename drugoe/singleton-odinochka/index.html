<!DOCTYPE html>
<html lang="en">
<head>
        <title>Singleton (одиночка)</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/theme/css/app.css" type="text/css" />
        <link href="http://dizballanze.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Tech blog by @dizballanze Atom Feed" />
        <link href="http://dizballanze.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Tech blog by @dizballanze RSS Feed" />
        <link href="/static/icons/favicon.ico" rel="icon" type="image/x-icon" />
        <link href="/static/icons/favicon.ico" rel="shortcut icon" type="image/x-icon" />
        
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ru_RU/all.js#xfbml=1&appId=143995599087385";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<a href="https://github.com/dizballanze">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="/">Tech blog by @dizballanze </a></h1>
                <nav><ul>
                    <li><a href="/avtor/">Автор</a></li>
                    <li ><a href="/category/bd.html">БД</a></li>
                    <li class="active"><a href="/category/drugoe.html">Другое</a></li>
                    <li ><a href="/category/linux.html">Linux</a></li>
                    <li ><a href="/category/nodejs.html">Node.js</a></li>
                    <li ><a href="/category/python.html">Python</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/drugoe/singleton-odinochka/" rel="bookmark"
           title="Permalink to Singleton (одиночка)">Singleton (одиночка)</a></h1>
<a href="http://twitter.com/share" class="twitter-share-button" data-width="80" data-count="horizontal" data-via="dizballanze" style="display:inline-block;">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

<div class="fb-like" data-send="false" data-layout="button_count" data-width="110" data-show-faces="true" data-font="trebuchet ms" style="display:inline-block;"></div>

<g:plusone size="medium" width="110" height="22" annotation="inline"></g:plusone>

<script type="text/javascript">
window.___gcfg = {
lang: 'en-US'
  };

  (function() {
var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
po.src = 'https://apis.google.com/js/plusone.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();
</script>

<!-- Put this script tag to the <head> of your page -->
<script type="text/javascript" src="//vk.com/js/api/openapi.js?75"></script>

<script type="text/javascript">
  VK.init({apiId: 2478358, onlyWidgets: true});
</script>

<!-- Put this div tag to the place, where the Like block will be -->
<div id="vk_like" style="display: inline-block; width: 110px;"></div>
<script type="text/javascript">
VK.Widgets.Like("vk_like", {type: "button"});
</script>    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2011-01-16T13:20:00+03:00">
                вс 16 января 2011
        </abbr>
<p>категория: <a href="/category/drugoe.html">Другое</a>. </p>
<p>теги: <a href="/tag/oop.html">ООП</a><a href="/tag/patterny-proektirovaniia.html">Паттерны проектирования</a></p>
</footer><!-- /.post-info -->      <p>Приветствую Вас, читатель моего блога! Первая статья из цикла паттерны
проектирования посвящена очень полезному шаблону - singleton. Почему я
решил начать именно с него? Всё очень просто, этот шаблон является
первым шаблоном который я начал использовать в практической разработке и
сразу же ощутил всю его мощь. Относится данный шаблон к шаблонам
порождающим объекты или к шаблонам генерации объектов. Итак, перейдём к
делу...</p>
<h2>Описание</h2>
<p>Шаблон singleton позволяет создавать лишь один экземпляр класса в
течении работы приложения. Это даёт ряд преимуществ:</p>
<ul>
<li>Глобальный доступ к объекту</li>
<li>Уверенность в том что есть только один экземпляр класса</li>
<li>Контроль доступа к данным</li>
</ul>
<p>Я думаю каждый понимает, что использование глобальных переменных вредит
качеству кода. Глобальные переменные создают ряд проблем:</p>
<ul>
<li>Засоряют область видимости</li>
<li>Их можно случайно затереть</li>
<li>Не инкапсулируют доступ к данным</li>
<li>Тяжело отслеживать их доступность на разных уровнях приложения</li>
</ul>
<p>При использовании рассматриваемого шаблона вместо глобальных переменных
мы избавляемся от всех вышеописанных проблем. Таким образом одиночка
является улучшенной версией глобальных переменных. Но здесь тоже не всё
так просто, злоупотреблять использованием данного шаблона нельзя, т.к.
это приводит к сильной зависимости других классов и может привести к
появлению непонятных, скрытых каналов данных.</p>
<h2>Реализация</h2>
<p>Реализация данного шаблона очень простая и сводится к созданию закрытого
конструктора, хранения экземпляра класса в статической переменной класса
и организации доступа к объекту через статический метод класса. Пример
шаблона одиночка:</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// ...</span>
<span class="k">class</span> <span class="nc">Singleton</span><span class="p">{</span>
    <span class="c1">//Экземпляр объекта Singleton</span>
    <span class="k">static</span> <span class="k">protected</span> <span class="nv">$instance</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="c1">//Метод предоставляет доступ к объекту</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">getInstance</span><span class="p">(){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span><span class="p">))</span>
            <span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Singleton</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$instance</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//Закрытый конструктор</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(){</span>
    <span class="k">echo</span> <span class="s1">&#39;New instance!&#39;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">__clone</span><span class="p">(){}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">someAction</span><span class="p">(){</span>
    <span class="k">echo</span> <span class="s1">&#39;Some action!&#39;</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Как Вы видите здесь всё очень просто, конструктор объявлен как private
метод, для того чтобы создавать экземпляр можно было только из методов
класса. Экземпляр класса хранится в приватной статической переменной
$instance и доступ к нему осуществляется через открытый статический
метод getInstance. Теперь рассмотрим, как применять данный класс:</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// ...</span>
<span class="nx">Singleton</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">someAction</span><span class="p">();</span>
<span class="nx">Singleton</span><span class="o">::</span><span class="na">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">someAction</span><span class="p">();</span>
</pre></div>


<p>В результате получаем следующий вывод:</p>
<div class="highlight"><pre>New instance!
Some action!
Some action!
</pre></div>


<p>Как Вы видите конструктор вызывается только 1 раз для 2х вызовов метода
getInstance.</p>
<h2>Применение</h2>
<p>Применять данный шаблон можно для многих задач. Наиболее часто он
применяется для следующих целей:</p>
<ul>
<li>Осуществление доступа к данным или функционалу на различных уровнях
    приложения. Например абстракция над http запросом и осуществление
    доступа к нему из контроллеров и видов приложения (для MVC
    архитектуры)</li>
<li>Абстракция над доступом к ресурсам. Например, контроль за тем чтобы
    в приложении создавался всего одно соединение с базой данных, ресурс
    которого сохраняется в объекте-одиночке.</li>
</ul>
<p>Это только некоторые способы применения данного шаблона. На этом всё.
Буду рад ответить на ваши вопросы по данной теме.</p>
    </div><!-- /.entry-content -->
    <div class="comments">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_identifier = "drugoe/singleton-odinochka/";
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://dizballanze.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>ссылки</h2>
                        <ul>
                            <li><a href="http://wbtech.pro">WBTech</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>онлайн</h2>
                        <ul>
                            <li><a href="http://dizballanze.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="http://dizballanze.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                            <li><a href="https://twitter.com/dizballanze">Twitter</a></li>
                            <li><a href="https://github.com/dizballanze">GitHub</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Powered by <a href="http://getpelican.com/">Pelican</a>, <a href="http://python.org">Python</a>.
                <section class="right">&copy; <a href="/avtor">Yuri Shikanov</a> 2010-2015</section>
                </address><!-- /#about -->

        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-20497524-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'dizballanze';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>