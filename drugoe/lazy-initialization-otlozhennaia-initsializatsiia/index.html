<!DOCTYPE html>
<html lang="en">
<head>
        <title>Lazy Initialization (отложенная инициализация)</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="/theme/css/app.css" type="text/css" />
        <link href="http://dizballanze.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Tech blog by @dizballanze Atom Feed" />
        <link href="http://dizballanze.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Tech blog by @dizballanze RSS Feed" />
        <link href="/static/icons/favicon.ico" rel="icon" type="image/x-icon" />
        <link href="/static/icons/favicon.ico" rel="shortcut icon" type="image/x-icon" />
        
        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ru_RU/all.js#xfbml=1&appId=143995599087385";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<a href="https://github.com/dizballanze">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="/">Tech blog by @dizballanze </a></h1>
                <nav><ul>
                    <li><a href="/автор/">Автор</a></li>
                    <li ><a href="/category/bd.html">БД</a></li>
                    <li class="active"><a href="/category/drugoe.html">Другое</a></li>
                    <li ><a href="/category/linux.html">Linux</a></li>
                    <li ><a href="/category/nodejs.html">Node.js</a></li>
                    <li ><a href="/category/python.html">Python</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/drugoe/lazy-initialization-otlozhennaia-initsializatsiia/" rel="bookmark"
           title="Permalink to Lazy Initialization (отложенная инициализация)">Lazy Initialization (отложенная инициализация)</a></h1>
<a href="http://twitter.com/share" class="twitter-share-button" data-width="80" data-count="horizontal" data-via="dizballanze" style="display:inline-block;">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

<div class="fb-like" data-send="false" data-layout="button_count" data-width="110" data-show-faces="true" data-font="trebuchet ms" style="display:inline-block;"></div>

<g:plusone size="medium" width="110" height="22" annotation="inline"></g:plusone>

<script type="text/javascript">
window.___gcfg = {
lang: 'en-US'
  };

  (function() {
var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
po.src = 'https://apis.google.com/js/plusone.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();
</script>

<!-- Put this script tag to the <head> of your page -->
<script type="text/javascript" src="//vk.com/js/api/openapi.js?75"></script>

<script type="text/javascript">
  VK.init({apiId: 2478358, onlyWidgets: true});
</script>

<!-- Put this div tag to the place, where the Like block will be -->
<div id="vk_like" style="display: inline-block; width: 110px;"></div>
<script type="text/javascript">
VK.Widgets.Like("vk_like", {type: "button"});
</script>    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2011-02-21T21:22:00+03:00">
                пн 21 февраля 2011
        </abbr>
<p>категория: <a href="/category/drugoe.html">Другое</a>. </p>
<p>теги: <a href="/tag/oop/">ООП</a><a href="/tag/patterny-proektirovaniia/">Паттерны проектирования</a></p>
</footer><!-- /.post-info -->      <p><img alt="lazy initialization" src="/media/2011/02/i-can-but-i-won-t-garfield-262532_800_600-300x225.jpg" title="lazy initialization" />Здравствуйте, сегодня речь пойдёт об очередном
паттерне - lazy initialization (отложенная инициализация). Освоив этот
паттерн вы научитесь инициализировать ресурсы только, тогда когда они
действительно нужны и тем самым увеличите скорость работы ваших
приложений.</p>
<h2 id="_1">Описание</h2>
<p>При проектировании вашего приложения вы можете столкнутся с
необходимостью создать классы, которые будут выполнять какие-либо
ресурсоемкие вычисления. Обычно первым приходящим на ум решением
является инициализация объекта и выполнение всех расчётов в момент
создания объекта(например в конструкторе), что-бы объект был полностью
готовым к использованию. Однако это решение хоть и является очевидным,
но уж точно не является оптимальным, т.к. вы не всегда можете быть
уверены в том, что результаты работы вашего объекта будут запрошёны тем
более вы не можете быть уверены что они будут востребованы полностью.
Существует вероятность того, что будут использоваться только 10% из тех
данных, которые вы инициализируете при создании объекта, соответственно
остальные 90% данных будут ненужны и потраченное на их подготовку время
будет безполезным. А представьте если таких объектов инициализируется
100...А если 1000? Вот тут то к нам на помощь приходит паттерн lazy
initialization. Суть данного паттерна в том, что данные обрабатываются
непосредственно в тот момент в который они запрашиваются. Т.е. когда
пользовательский код запрашивает какие-то данные у нашего объекта, мы
сначала проверяем не вычесленны ли эти данные ранее, если нет, то
вычисляем их сохраняем внутри объекта и возвращаем запрашиваемому коду.
Таким образом необходимые данные будут вычислинны тогда и только тогда,
когда они будут необходимы. Это позволит значительным образом
съекономить время и память, тем более что аренда серверов сейчас стоит
совсем не дёшево ;)</p>
<h2 id="_2">Реализация</h2>
<p>Давайте рассмотрим реализацию данного шаблона на примере класса, который
"лениво" вычисляет факториал:</p>
<pre><code>:::php
&lt;?php
class LazyFactorial{
    protected $factorial = array(1);

    protected function addFactorials($n){
        echo 'Add ' . $n . '!' . "\n";
        for ($i = count($this-&gt;factorial); $i &lt;= $n; $i++){
            $this-&gt;factorial[$i] = $this-&gt;factorial[$i-1]*$i;
        }
    }

    public function getFactorial($n){
        if (!array_key_exists($n, $this-&gt;factorial)){
            $this-&gt;addFactorials($n);
        }
        return $this-&gt;factorial[$n];
    }

    public function printFactorials(){
        print_r($this-&gt;factorial);
    }
}
</code></pre>
<p>В данном примере у нас есть класс, который вычисляет факториал. Как вы
видите данный класс никаким образом не инициализируется (что для этого
примера очевидно), затем для того что-бы пользователь смог запросить
вычисление факториала мы реализуем метод getFactorial, который сначала
проверяет небыл ли нужный факториал вычеслен ранее, если нет, то
запускает вычисления. Метод отвечающий за вычисления (addFactorials)
расширяет массив факториалов до необходимого нам количества. Очевидно,
что при работе с данным классом мы во-первых будем вычислять факториал
определённого числа только тогда, когда он нам понадобится, во-вторых мы
не будем вычислять одно и то же значение дважды. Пример использования
класса:</p>
<pre><code>:::php
$factorial = new LazyFactorial();
$factorial-&gt;printFactorials();
echo $factorial-&gt;getFactorial(2) . "\n";
$factorial-&gt;printFactorials();
echo $factorial-&gt;getFactorial(6) . "\n";
$factorial-&gt;printFactorials();
echo $factorial-&gt;getFactorial(3) . "\n";
$factorial-&gt;printFactorials();
</code></pre>
<p>В результате получаем следующий вывод:</p>
<pre><code>:::test
Array
(
    [0] =&gt; 1
)
Add 2!
2
Array
(
    [0] =&gt; 1
    [1] =&gt; 1
    [2] =&gt; 2
)
Add 6!
720
Array
(
    [0] =&gt; 1
    [1] =&gt; 1
    [2] =&gt; 2
    [3] =&gt; 6
    [4] =&gt; 24
    [5] =&gt; 120
    [6] =&gt; 720
)
6
Array
(
    [0] =&gt; 1
    [1] =&gt; 1
    [2] =&gt; 2
    [3] =&gt; 6
    [4] =&gt; 24
    [5] =&gt; 120
    [6] =&gt; 720
)
</code></pre>
<p>Как вы видите наши ожидания подтвердились. Возможно данный пример не
полностью отражает суть паттерна lazy initialization, но основная мысль
передаётся точно. Если есть какие-либо вопросы задавайте их в
комментариях. Спасибо за внимание!</p>
    </div><!-- /.entry-content -->
    <div class="comments">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_identifier = "drugoe/lazy-initialization-otlozhennaia-initsializatsiia/";
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://dizballanze.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>ссылки</h2>
                        <ul>
                            <li><a href="http://wbtech.pro">WBTech</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>онлайн</h2>
                        <ul>
                            <li><a href="http://dizballanze.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="http://dizballanze.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                            <li><a href="https://twitter.com/dizballanze">Twitter</a></li>
                            <li><a href="https://github.com/dizballanze">GitHub</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Powered by <a href="http://getpelican.com/">Pelican</a>, <a href="http://python.org">Python</a>.
                <section class="right">&copy; <a href="/avtor">Yuri Shikanov</a> 2010-2015</section>
                </address><!-- /#about -->

        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-20497524-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
<script type="text/javascript">
    var disqus_shortname = 'dizballanze';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>